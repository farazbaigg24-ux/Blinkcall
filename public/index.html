<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Blindcall ‚Äî Anonymous Voice Calls</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:#04070d;color:#e2edf5;font-family:system-ui,-apple-system,sans-serif;min-height:100vh;overflow-x:hidden}
    header{display:flex;align-items:center;justify-content:space-between;padding:16px 24px;border-bottom:1px solid #162030;background:rgba(4,7,13,0.95);position:sticky;top:0;z-index:100}
    .logo{font-size:1.3rem;font-weight:900;letter-spacing:-1px}
    .logo span{color:#00e5ff}
    .online-pill{display:flex;align-items:center;gap:6px;padding:5px 12px;background:rgba(0,229,255,0.06);border:1px solid rgba(0,229,255,0.2);border-radius:100px;font-size:0.72rem;color:#00e5ff}
    .dot{width:6px;height:6px;border-radius:50%;background:#00e5ff;box-shadow:0 0 6px #00e5ff;animation:pulse 2s infinite}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.3}}
    .screen{display:none}
    .screen.active{display:flex;flex-direction:column}

    /* HOME */
    #home{min-height:calc(100vh - 57px);align-items:center;justify-content:center;text-align:center;padding:30px 20px;gap:28px}
    .badge{display:inline-block;padding:6px 14px;background:rgba(0,229,255,0.06);border:1px solid rgba(0,229,255,0.2);border-radius:100px;font-size:0.72rem;color:#00e5ff}
    .hero-title{font-size:clamp(2.5rem,8vw,5rem);font-weight:900;line-height:1;letter-spacing:-2px}
    .hero-title .glow{color:#00e5ff;text-shadow:0 0 30px rgba(0,229,255,0.4)}
    .hero-title .dim{opacity:0.35}
    .hero-sub{font-size:0.95rem;color:#8aa8be;max-width:420px;line-height:1.7}
    .stats{display:flex;gap:28px;align-items:center}
    .stat{text-align:center}
    .stat-n{font-size:1.4rem;font-weight:900;color:#00e5ff;display:block}
    .stat-l{font-size:0.65rem;color:#4a6880;text-transform:uppercase;letter-spacing:1px}
    .divider{width:1px;height:36px;background:#162030}
    .interests-section{width:100%;max-width:560px}
    .section-label{font-size:0.65rem;color:#4a6880;text-transform:uppercase;letter-spacing:2px;margin-bottom:12px;text-align:left}
    .tags{display:flex;flex-wrap:wrap;gap:7px;margin-bottom:10px}
    .tag{padding:6px 14px;border-radius:100px;border:1px solid #1e2f42;background:#0c1520;color:#4a6880;font-size:0.75rem;cursor:pointer;transition:all 0.2s}
    .tag:hover{border-color:rgba(0,229,255,0.4);color:#00e5ff}
    .tag.on{border-color:#00e5ff;background:rgba(0,229,255,0.08);color:#00e5ff}
    .custom-row{display:flex;gap:8px}
    .custom-input{flex:1;background:#0c1520;border:1px solid #1e2f42;border-radius:10px;padding:9px 14px;color:#e2edf5;font-size:0.8rem;outline:none}
    .custom-input:focus{border-color:rgba(0,229,255,0.4)}
    .custom-input::placeholder{color:#4a6880}
    .btn-add{padding:9px 16px;background:#111d2b;border:1px solid #1e2f42;border-radius:10px;color:#00e5ff;font-size:0.8rem;cursor:pointer;white-space:nowrap}
    .btn-start{padding:16px 44px;background:#00e5ff;border:none;border-radius:14px;color:#000;font-weight:900;font-size:1rem;cursor:pointer;transition:all 0.3s;box-shadow:0 0 25px rgba(0,229,255,0.3)}
    .btn-start:hover{transform:translateY(-2px);box-shadow:0 0 40px rgba(0,229,255,0.5)}
    .disclaimer{font-size:0.7rem;color:#4a6880}
    .chips{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;padding:0 20px 40px}
    .chip{display:flex;align-items:center;gap:7px;padding:9px 16px;background:#080e18;border:1px solid #162030;border-radius:10px;font-size:0.78rem;color:#8aa8be}

    /* SEARCHING */
    #searching{min-height:calc(100vh - 57px);align-items:center;justify-content:center;gap:24px;text-align:center}
    .spin-wrap{position:relative;width:120px;height:120px}
    .spin-ring{position:absolute;inset:0;border-radius:50%;border:2px solid transparent}
    .s1{border-top-color:#00e5ff;animation:spin 1.4s linear infinite}
    .s2{inset:16px;border-right-color:#ff3cac;animation:spin 2s linear infinite reverse}
    .s3{inset:32px;border-bottom-color:#7b2fff;animation:spin 1s linear infinite}
    .spin-center{position:absolute;inset:44px;background:#0c1520;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.4rem}
    @keyframes spin{to{transform:rotate(360deg)}}
    .search-title{font-size:1.6rem;font-weight:900;letter-spacing:-1px}
    .search-sub{font-size:0.8rem;color:#4a6880}
    .btn-cancel{padding:9px 22px;background:transparent;border:1px solid#1e2f42;border-radius:10px;color:#4a6880;font-size:0.82rem;cursor:pointer}

    /* CHAT */
    #chat{min-height:calc(100vh - 57px);padding:16px;gap:14px}
    .disc-bar{display:none;align-items:center;justify-content:space-between;padding:10px 16px;background:rgba(255,60,172,0.06);border:1px solid rgba(255,60,172,0.2);border-radius:10px;font-size:0.8rem;color:#ff3cac}
    .disc-bar.show{display:flex}
    .chat-grid{display:grid;grid-template-columns:1fr 340px;gap:14px;flex:1}
    @media(max-width:780px){.chat-grid{grid-template-columns:1fr}}
    .voice-card{background:#080e18;border:1px solid#162030;border-radius:18px;padding:28px 20px;display:flex;flex-direction:column;align-items:center;gap:18px}
    .status{padding:4px 12px;border-radius:100px;font-size:0.65rem;text-transform:uppercase;letter-spacing:2px;font-weight:700}
    .s-connecting{background:rgba(123,47,255,0.1);color:#7b2fff;border:1px solid rgba(123,47,255,0.3)}
    .s-connected{background:rgba(0,229,255,0.1);color:#00e5ff;border:1px solid rgba(0,229,255,0.3)}
    .avatar-wrap{position:relative;width:110px;height:110px}
    .avatar{width:100%;height:100%;border-radius:50%;background:#0c1520;border:2px solid#1e2f42;display:flex;align-items:center;justify-content:center;font-size:2.8rem;position:relative;z-index:2}
    .ripple-wrap{position:absolute;inset:-14px;border-radius:50%}
    .rr{position:absolute;inset:0;border-radius:50%;border:1.5px solid#00e5ff;opacity:0}
    .speaking .rr:nth-child(1){animation:rpl 2s ease-out infinite}
    .speaking .rr:nth-child(2){animation:rpl 2s ease-out 0.4s infinite}
    .speaking .rr:nth-child(3){animation:rpl 2s ease-out 0.8s infinite}
    @keyframes rpl{0%{transform:scale(0.8);opacity:0.6}100%{transform:scale(1.9);opacity:0}}
    .stranger-name{font-size:1.1rem;font-weight:900;letter-spacing:-0.5px}
    .timer{font-size:0.85rem;font-weight:700;color:#4a6880;letter-spacing:2px}
    .waveform{display:flex;align-items:center;gap:3px;height:44px}
    .wb{width:4px;background:linear-gradient(to top,#7b2fff,#00e5ff);border-radius:3px;opacity:0.2;height:6px;transition:height 0.08s}
    .wf-active .wb{opacity:0.85}
    .mic-wrap{display:flex;flex-direction:column;align-items:center;gap:6px}
    .mic-btn{width:62px;height:62px;border-radius:50%;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.5rem;transition:all 0.2s}
    .mic-on{background:#00e5ff;color:#000;box-shadow:0 0 22px rgba(0,229,255,0.4)}
    .mic-muted{background:#0c1520;color:#ff3cac;border:1px solid rgba(255,60,172,0.4)}
    .mic-label{font-size:0.68rem;color:#4a6880}
    .action-row{display:flex;gap:10px;width:100%}
    .btn-next{flex:1;padding:11px;background:#0c1520;border:1px solid#1e2f42;border-radius:11px;color:#e2edf5;font-weight:700;font-size:0.88rem;cursor:pointer;transition:all 0.2s}
    .btn-next:hover{border-color:#00e5ff;color:#00e5ff}
    .btn-rep{padding:11px 16px;background:transparent;border:1px solid rgba(255,60,172,0.3);border-radius:11px;color:#ff3cac;font-weight:700;font-size:0.88rem;cursor:pointer}
    .chat-panel{background:#080e18;border:1px solid#162030;border-radius:18px;display:flex;flex-direction:column;overflow:hidden}
    .chat-top{padding:14px 18px;border-bottom:1px solid#162030;font-weight:700;font-size:0.88rem;display:flex;align-items:center;gap:8px}
    .msgs{flex:1;overflow-y:auto;padding:14px;display:flex;flex-direction:column;gap:8px;min-height:260px;max-height:400px}
    .msgs::-webkit-scrollbar{width:3px}
    .msgs::-webkit-scrollbar-thumb{background:#1e2f42;border-radius:2px}
    .msg{max-width:82%;padding:9px 13px;border-radius:13px;font-size:0.82rem;line-height:1.5;word-break:break-word}
    .msg.me{align-self:flex-end;background:rgba(0,229,255,0.1);border:1px solid rgba(0,229,255,0.2);color:#00e5ff;border-bottom-right-radius:3px}
    .msg.them{align-self:flex-start;background:#0c1520;border:1px solid#1e2f42;color:#e2edf5;border-bottom-left-radius:3px}
    .msg.sys{align-self:center;background:transparent;color:#4a6880;font-size:0.72rem;border:none;font-style:italic}
    .chat-input-row{padding:10px;border-top:1px solid#162030;display:flex;gap:8px;align-items:flex-end}
    .chat-ta{flex:1;background:#0c1520;border:1px solid#1e2f42;border-radius:11px;padding:9px 13px;color:#e2edf5;font-size:0.82rem;outline:none;resize:none;font-family:inherit}
    .chat-ta:focus{border-color:rgba(0,229,255,0.3)}
    .chat-ta::placeholder{color:#4a6880}
    .send-btn{width:40px;height:40px;background:#00e5ff;border:none;border-radius:10px;cursor:pointer;color:#000;font-size:1rem;display:flex;align-items:center;justify-content:center;flex-shrink:0}

    /* MODAL */
    .modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.75);z-index:200;align-items:center;justify-content:center;padding:20px}
    .modal-bg.open{display:flex}
    .modal{background:#080e18;border:1px solid#1e2f42;border-radius:18px;padding:28px;max-width:400px;width:100%}
    .modal-title{font-size:1.2rem;font-weight:900;color:#ff3cac;margin-bottom:6px}
    .modal-sub{font-size:0.8rem;color:#4a6880;margin-bottom:18px;line-height:1.6}
    .report-opts{display:flex;flex-direction:column;gap:7px;margin-bottom:18px}
    .ropt{padding:10px 14px;background:#0c1520;border:1px solid#1e2f42;border-radius:9px;color:#8aa8be;cursor:pointer;font-size:0.82rem;text-align:left;transition:all 0.2s;font-family:inherit}
    .ropt:hover,.ropt.on{border-color:#ff3cac;color:#ff3cac;background:rgba(255,60,172,0.06)}
    .modal-btns{display:flex;gap:10px;justify-content:flex-end}
    .btn-mcancel{padding:9px 18px;background:transparent;border:1px solid#1e2f42;border-radius:9px;color:#4a6880;font-size:0.82rem;cursor:pointer;font-family:inherit}
    .btn-mrep{padding:9px 18px;background:rgba(255,60,172,0.1);border:1px solid#ff3cac;border-radius:9px;color:#ff3cac;font-weight:700;font-size:0.82rem;cursor:pointer;font-family:inherit}

    /* TOAST */
    .toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(80px);background:#0c1520;border:1px solid#1e2f42;border-radius:10px;padding:10px 20px;font-size:0.8rem;z-index:300;transition:transform 0.3s;white-space:nowrap}
    .toast.show{transform:translateX(-50%) translateY(0)}
    .toast.ok{border-color:#00e5ff;color:#00e5ff}
    .toast.err{border-color:#ff3cac;color:#ff3cac}
    audio{display:none}
  </style>
</head>
<body>

<header>
  <div class="logo">Blind<span>call</span></div>
  <div class="online-pill">
    <div class="dot"></div>
    <span id="online-count">0 online</span>
  </div>
</header>

<div id="app">

  <!-- HOME -->
  <div id="home" class="screen active">
    <div class="badge">No face. No name. Just your voice.</div>

    <h1 class="hero-title">
      Call a stranger.<br>
      <span class="glow">Blindly.</span><br>
      <span class="dim">Anonymously.</span>
    </h1>

    <p class="hero-sub">Random anonymous voice calls with strangers worldwide. No account, no camera ‚Äî just your voice in the dark.</p>

    <div class="stats">
      <div class="stat">
        <span class="stat-n" id="stat-online">0</span>
        <span class="stat-l">Online</span>
      </div>
      <div class="divider"></div>
      <div class="stat">
        <span class="stat-n">100%</span>
        <span class="stat-l">Anonymous</span>
      </div>
      <div class="divider"></div>
      <div class="stat">
        <span class="stat-n">Free</span>
        <span class="stat-l">Forever</span>
      </div>
    </div>

    <div class="interests-section">
      <div class="section-label">Match by interest (optional)</div>
      <div class="tags" id="tags">
        <div class="tag" data-tag="music">üéµ Music</div>
        <div class="tag" data-tag="gaming">üéÆ Gaming</div>
        <div class="tag" data-tag="movies">üé¨ Movies</div>
        <div class="tag" data-tag="sports">‚öΩ Sports</div>
        <div class="tag" data-tag="tech">üíª Tech</div>
        <div class="tag" data-tag="art">üé® Art</div>
        <div class="tag" data-tag="travel">‚úàÔ∏è Travel</div>
        <div class="tag" data-tag="food">üçú Food</div>
        <div class="tag" data-tag="anime">‚õ©Ô∏è Anime</div>
        <div class="tag" data-tag="fitness">üí™ Fitness</div>
        <div class="tag" data-tag="books">üìö Books</div>
        <div class="tag" data-tag="language">üó£Ô∏è Language</div>
      </div>
      <div class="custom-row">
        <input class="custom-input" id="custom-input" type="text" placeholder="Add your interest..." maxlength="20"/>
        <button class="btn-add" onclick="addTag()">+ Add</button>
      </div>
    </div>

    <button class="btn-start" onclick="startSearch()">üìû Start Blind Call</button>
    <span class="disclaimer">No signup ¬∑ No camera ¬∑ Free forever</span>

    <div class="chips">
      <div class="chip">üôà No Camera</div>
      <div class="chip">üéôÔ∏è Voice Only</div>
      <div class="chip">üé≠ Anonymous</div>
      <div class="chip">üí¨ Live Chat</div>
      <div class="chip">‚è≠Ô∏è Skip Anytime</div>
      <div class="chip">üåç Worldwide</div>
    </div>
  </div>

  <!-- SEARCHING -->
  <div id="searching" class="screen">
    <div class="spin-wrap">
      <div class="spin-ring s1"></div>
      <div class="spin-ring s2"></div>
      <div class="spin-ring s3"></div>
      <div class="spin-center">üìû</div>
    </div>
    <div class="search-title">Finding stranger...</div>
    <p class="search-sub">Matching you with someone worldwide</p>
    <button class="btn-cancel" onclick="cancelSearch()">Cancel</button>
  </div>

  <!-- CHAT -->
  <div id="chat" class="screen">
    <div id="disc-bar" class="disc-bar">
      <span>‚ö†Ô∏è Stranger disconnected</span>
      <button class="btn-next" style="width:auto;padding:5px 14px;font-size:0.78rem" onclick="nextStranger()">Find New ‚Üí</button>
    </div>
    <div class="chat-grid">
      <div class="voice-card">
        <div id="vstatus" class="status s-connecting">Connecting...</div>
        <div class="avatar-wrap">
          <div class="avatar">üé≠</div>
          <div class="ripple-wrap" id="ripple">
            <div class="rr"></div>
            <div class="rr"></div>
            <div class="rr"></div>
          </div>
        </div>
        <div class="stranger-name">Anonymous Stranger</div>
        <div class="timer" id="timer">00:00</div>
        <div class="waveform" id="waveform">
          <div class="wb" style="height:6px"></div>
          <div class="wb" style="height:14px"></div>
          <div class="wb" style="height:22px"></div>
          <div class="wb" style="height:9px"></div>
          <div class="wb" style="height:18px"></div>
          <div class="wb" style="height:6px"></div>
          <div class="wb" style="height:14px"></div>
          <div class="wb" style="height:22px"></div>
          <div class="wb" style="height:9px"></div>
          <div class="wb" style="height:16px"></div>
          <div class="wb" style="height:7px"></div>
          <div class="wb" style="height:20px"></div>
        </div>
        <div class="mic-wrap">
          <button class="mic-btn mic-on" id="mic-btn" onclick="toggleMic()">üéôÔ∏è</button>
          <span class="mic-label" id="mic-label">Tap to mute</span>
        </div>
        <div class="action-row">
          <button class="btn-next" onclick="nextStranger()">‚è≠ Next Stranger</button>
          <button class="btn-rep" onclick="openReport()">‚öë</button>
        </div>
      </div>
      <div class="chat-panel">
        <div class="chat-top">üí¨ Live Chat</div>
        <div class="msgs" id="msgs">
          <div class="msg sys">Connected! Say hello üëã</div>
        </div>
        <div class="chat-input-row">
          <textarea class="chat-ta" id="chat-input" placeholder="Type a message..." rows="1" onkeydown="handleKey(event)"></textarea>
          <button class="send-btn" onclick="sendMsg()">‚û§</button>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Report Modal -->
<div class="modal-bg" id="modal">
  <div class="modal">
    <div class="modal-title">Report User</div>
    <p class="modal-sub">Select a reason. This disconnects you and flags the user.</p>
    <div class="report-opts">
      <button class="ropt" onclick="pickReason(this,'Inappropriate behavior')">Inappropriate behavior</button>
      <button class="ropt" onclick="pickReason(this,'Harassment or bullying')">Harassment or bullying</button>
      <button class="ropt" onclick="pickReason(this,'Hate speech')">Hate speech</button>
      <button class="ropt" onclick="pickReason(this,'Spam or bot')">Spam or bot</button>
      <button class="ropt" onclick="pickReason(this,'Other')">Other</button>
    </div>
    <div class="modal-btns">
      <button class="btn-mcancel" onclick="closeReport()">Cancel</button>
      <button class="btn-mrep" onclick="submitReport()">Submit</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>
<audio id="remote-audio" autoplay playsinline></audio>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  let stream=null,peer=null,muted=false,reason=null,partnerId=null,initiator=false,interests=[],waveInt=null,audioCtx=null,analyser=null,timerInt=null,secs=0;
  const ice={iceServers:[{urls:'stun:stun.l.google.com:19302'},{urls:'stun:stun1.l.google.com:19302'}]};

  function show(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active')}

  // Tags
  document.querySelectorAll('.tag').forEach(t=>{t.addEventListener('click',()=>{const v=t.dataset.tag;t.classList.toggle('on');interests=t.classList.contains('on')?[...interests,v]:interests.filter(i=>i!==v)})});
  function addTag(){const inp=document.getElementById('custom-input');const v=inp.value.trim().toLowerCase();if(!v||interests.includes(v)){inp.value='';return}const t=document.createElement('div');t.className='tag on';t.dataset.tag=v;t.textContent='# '+v;t.addEventListener('click',()=>{t.classList.toggle('on');interests=t.classList.contains('on')?[...interests,v]:interests.filter(i=>i!==v)});document.getElementById('tags').appendChild(t);interests.push(v);inp.value=''}
  document.getElementById('custom-input').addEventListener('keydown',e=>{if(e.key==='Enter')addTag()});

  // Search
  async function startSearch(){try{stream=await navigator.mediaDevices.getUserMedia({audio:true,video:false});show('searching');socket.emit('join',{interests})}catch(e){toast('Mic access denied','err')}}
  function cancelSearch(){socket.emit('leave');show('home')}

  // Socket
  socket.on('online-count',n=>{document.getElementById('online-count').textContent=n+' online';document.getElementById('stat-online').textContent=n});
  socket.on('waiting',()=>show('searching'));
  socket.on('matched',async({partnerId:pid,isInitiator:init})=>{partnerId=pid;initiator=init;show('chat');document.getElementById('disc-bar').classList.remove('show');clearMsgs();sysMsg('Connected! Say hello üëã');setStatus('Connecting...','s-connecting');startTimer();await setupPeer();if(initiator){const o=await peer.createOffer();await peer.setLocalDescription(o);socket.emit('signal',{to:pid,signal:{type:'offer',sdp:o}})}});
  socket.on('signal',async({from,signal})=>{if(!peer)return;if(signal.type==='offer'){await peer.setRemoteDescription(new RTCSessionDescription(signal.sdp));const a=await peer.createAnswer();await peer.setLocalDescription(a);socket.emit('signal',{to:from,signal:{type:'answer',sdp:a}})}else if(signal.type==='answer'){await peer.setRemoteDescription(new RTC
